def safe_show_exception(e):
    # Stocke l'exception dans session_state
    st.session_state.last_exception_str = str(e)

    # Affiche le message d'erreur générique
    st.error("Une erreur est survenue. Vérifiez vos fichiers ou contactez le support.")

    # Checkbox pour afficher les détails (valeur persistante dans session_state)
    if "show_exception" not in st.session_state:
        st.session_state.show_exception = False

    st.session_state.show_exception = st.checkbox(
        "Afficher détails techniques",
        value=st.session_state.show_exception
    )

    # Affiche les détails techniques seulement si la checkbox est cochée
    if st.session_state.show_exception and "last_exception_str" in st.session_state:
        st.text(st.session_state.last_exception_str)
