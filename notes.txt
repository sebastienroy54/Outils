# Python 3.7 (compatible Oracle 10g)
FROM python:3.7-buster

# Dépendances système requises par Oracle Instant Client
RUN apt-get update && apt-get install -y \
    libaio1 \
    unzip \
    && rm -rf /var/lib/apt/lists/*

# Oracle Instant Client 10.2
WORKDIR /opt/oracle

# Copier les ZIP fournis (pas de téléchargement)
COPY basic-10.2.0.5.0-linux-x64.zip .
COPY sqlplus-10.2.0.5.0-linux-x64.zip .

RUN unzip basic-10.2.0.5.0-linux-x64.zip \
 && unzip sqlplus-10.2.0.5.0-linux-x64.zip \
 && rm *.zip

# Variables Oracle
ENV ORACLE_HOME=/opt/oracle/instantclient_10_2
ENV LD_LIBRARY_PATH=$ORACLE_HOME
ENV PATH=$ORACLE_HOME:$PATH

# App
WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app /app
COPY sql /app/sql

# Dossier output
RUN mkdir -p /app/output

CMD ["python", "/app/main.py"]
