def lire_fichier_excel(fichier):
    df = pd.read_excel(fichier, header=None, dtype=str, engine='openpyxl')
    resume_filtrage = df.iloc[3, 0]
    periode = str(df.iloc[4, 0])
    filtres = df.iloc[5, 0]
    detail_valo = df.iloc[7, 0]

    import re
    match = re.search(r"(\d{4})", periode)
    annee = match.group(1) if match else "XXXX"

    data = pd.read_excel(fichier, header=8, dtype=str, engine='openpyxl')
    data = data.iloc[:, :4]
    data.columns = ["Indicateur", "Valorisation", "Quantité", "Unité"]

    # Conversion des colonnes numériques
    data["Valorisation"] = pd.to_numeric(data["Valorisation"], errors='coerce')
    data["Quantité"] = pd.to_numeric(data["Quantité"], errors='coerce')

    # ✅ Harmonisation des valeurs manquantes dans "Unité"
    # Les NaN ou "nan" deviennent simplement des chaînes vides
    data["Unité"] = data["Unité"].replace("nan", "").fillna("")

    return annee, data, {
        "Résumé": resume_filtrage,
        "Période": periode,
        "Filtres": filtres,
        "Détail": detail_valo
    }
