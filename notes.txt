SET LINESIZE 32767
SET HEADING ON
SET COLSEP ";"
SET PAGESIZE 0
SET FEEDBACK OFF
SET TRIMSPOOL ON
SET WRAP OFF
SET TERMOUT OFF
SPOOL C:/Users/4251352/Portail_outils/data/resultat.csv
SELECT DISTINCT S.KYNOIP AS IPP,
       S.DANAIS AS DATE_NAISSANCE,
       E.KYNODA AS NDA,
       E.CDURM_P AS UMA,
       E.D8EEUE AS DATE_ENTREE,
       E.D8SOUE AS DATE_SORTIE
FROM EPI E, SDO S
WHERE E.KYNODA = S.KYNODA
  -- AND E.CDURM_P IS NOT NULL
  -- AND TRIM(E.CDURM_P) <> ''
  AND E.D8EEUE >= TO_DATE('01/01/2025','DD/MM/YYYY')
  AND E.D8EEUE <= TRUNC(SYSDATE)
  -- AND EXISTS (
  --     SELECT 1 FROM EPI E2, SDO S2
  --     WHERE E2.KYNODA = S2.KYNODA
  --       AND S2.KYNOIP = S.KYNOIP
  --       AND TRUNC(E2.D8EEUE) >= TO_DATE('01/01/2024','DD/MM/YYYY')
  --       AND TRUNC(E2.D8EEUE) <= TRUNC(SYSDATE)
  --       AND E2.KYNODA <> E.KYNODA)
ORDER BY S.KYNOIP, E.D8EEUE;
SPOOL OFF
EXIT;
