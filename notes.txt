def test_oracle_connection(user, password, tns_alias):
    cmd = ["sqlplus", "-S", f"{user}/{password}@{tns_alias}", f"@{TEST_SQL}"]

    try:
        result = subprocess.run(
            cmd,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            text=True,
            timeout=10
        )

        # Si échec, on affiche le vrai message (ORA-xxxx) pour debug
        if result.returncode != 0:
            st.error("Connexion Oracle échouée")
            st.code(result.stderr or result.stdout)
            return False

        return True

    except subprocess.TimeoutExpired:
        st.error("Connexion Oracle: timeout")
        return False
    except Exception as e:
        st.error(f"Connexion Oracle: erreur inattendue: {e}")
        return False
