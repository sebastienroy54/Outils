whenever sqlerror exit 1
whenever oserror exit 2
set heading off feedback off pagesize 0 verify off echo off
select 1 from dual;
exit;

SET LINESIZE 32767
SET HEADING ON
SET COLSEP ";"
SET PAGESIZE 0
SET FEEDBACK OFF
SET TRIMSPOOL ON
SET WRAP OFF
SET TERMOUT OFF
SPOOL C:/Users/4251352/Portail_outils/data/resultat.csv
SELECT DISTINCT S.KYNOIP AS IPP,
       S.DANAIS AS DATE_NAISSANCE,
       E.KYNODA AS NDA,
       E.CDURM_P AS UMA,
       R.CDGHM AS GHM,
       TO_CHAR(E.D8EEUE, 'DD/MM/YYYY') AS DATE_ENTREE,
       TO_CHAR(E.D8SOUE, 'DD/MM/YYYY') AS DATE_SORTIE
FROM EPI E, SDO S, RSS R
WHERE E.KYNODA = S.KYNODA
  AND E.KYNODA = R.NODA(+)
  AND E.D8EEUE >= TO_DATE('01/01/2025','DD/MM/YYYY')
  AND E.D8EEUE <= TRUNC(SYSDATE)
  AND E.CHPPMSI = 'CS'
ORDER BY S.KYNOIP;
SPOOL OFF
EXIT;
