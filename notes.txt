if execute_sql:
    tns_alias = "SIP1CCH.WORLD"

    with st.spinner("ğŸ” Test de connexion Oracle..."):
        is_ok = test_oracle_connection(user, password, tns_alias)

    if not is_ok:
        st.error("âŒ Connexion Oracle Ã©chouÃ©e : identifiants invalides.")
        st.stop()

    st.success("âœ… Connexion Oracle validÃ©e.")

    with st.spinner("ğŸ§  ExÃ©cution de la requÃªte SQL, veuillez patienter..."):
        cmd = f'sqlplus {user}/{password}@{tns_alias} @{SQL_PATH}'
        subprocess.run(cmd, shell=True)

    st.success("âœ… RequÃªte SQL terminÃ©e et fichier CSV gÃ©nÃ©rÃ©.")
    st.divider()
