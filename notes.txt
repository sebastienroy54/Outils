        if submitted:
            if not user or not password:
                st.error("Veuillez renseigner vos identifiants Oracle.")
                st.stop()

            tns_alias = "SIP1CCH.WORLD"
            test_sql_path = "C:/Users/4251352/Portail_outils/SQL/test_connexion.sql"
            Path(test_sql_path).write_text("select 1 from dual;\nexit;", encoding="utf-8")

            test_cmd = f"sqlplus -S {user}/{password}@{tns_alias} @{test_sql_path}"

            proc = subprocess.Popen(test_cmd, shell=True, stdout=subprocess.PIPE, text=True)
            timeout = 3
            start = time.time()
            output = ""
            while True:
                if proc.poll() is not None:
                    out, err = proc.communicate()
                    output += out
                    break
                elif time.time() - start > timeout:
                    proc.kill()
                    st.error("Timeout. Vérifiez vos identifiants de connexion Oracle")
                    st.stop()
                else:
                    time.sleep(0.1)
            if "1" in output:
                st.session_state.oracle_user = user
                st.session_state.oracle_password = password
                st.session_state.oracle_connected = True
                st.rerun()
            else:
                st.error("Connexion échouée. Vérifiez vos identifiants Oracle.")
                st.stop()
        return
