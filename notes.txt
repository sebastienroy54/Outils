def page_connexion():
    st.title("Connexion Oracle")

    if not st.session_state.logged_in:  # SI PAS CONNECTÃ‰
        with st.form("connexion"):
            st.subheader("Connexion Oracle")
            user = st.text_input("ðŸ‘¤ Nom d'utilisateur Oracle :", key="conn_user")
            password = st.text_input("ðŸ”‘ Mot de passe :", type="password", key="conn_pwd")
            submitted = st.form_submit_button("ðŸš€ Se connecter")

        if submitted:
            if not user or not password:
                st.error("Veuillez renseigner vos identifiants Oracle.")
                return

            try:
                st.info("Test de connexion...")
                tns_alias = TNS_MAP["CCH"]
                test_sql_path = SQL_DIR / "test_connexion.sql"
                test_sql_path.write_text("select 1 from dual;\nexit;", encoding="utf-8")

                cmd = f"sqlplus -S {user}/{password}@{tns_alias} @{test_sql_path}"
                out = run_sqlplus_and_wait(cmd, timeout=3)

                if "1" in out:
                    st.session_state.logged_in = True
                    st.session_state.oracle_user = user
                    st.session_state.oracle_password = password
                    st.session_state.page = "rum"
                    st.rerun()
                else:
                    st.error("Connexion Ã©chouÃ©e. VÃ©rifiez vos identifiants Oracle.")
            except Exception as e:
                safe_show_exception(e)
            finally:
                try:
                    test_sql_path.unlink()
                except:
                    pass

    else:  # SI DÃ‰JÃ€ CONNECTÃ‰
        st.success("Connexion active.")
        if st.button("âž¡ Aller Ã  la page RUM"):
            st.session_state.page = "rum"
            st.rerun()
