---
title: "Diagnostic lecture fichier ANOHOSP"
output: html_document
---

```{r}
# --- CONFIGURATION ----------------------------------------------------------

# ‚ö†Ô∏è Remplace ce chemin par le tien :
fichier <- "SSR21_Anohosp.fic"   # ou le nom exact du fichier √† tester

# Si le fichier est dans le m√™me dossier que ce script :
# fichier <- "./SSR21_Anohosp.fic"

# --- CHARGEMENT DES PACKAGES -----------------------------------------------
library(readr)
library(stringr)

# --- TEST 1 : V√©rifier que le fichier est visible --------------------------
cat("üìÅ R√©pertoire de travail :", getwd(), "\n")
cat("üìÑ Fichier existe :", file.exists(fichier), "\n")
cat("‚ÑπÔ∏è Informations sur le fichier :\n")
print(file.info(fichier))

# --- TEST 2 : Lecture simple du fichier -----------------------------------
cat("\n--- Lecture avec read_lines (encodage par d√©faut) ---\n")
anohosp1 <- read_lines(fichier)
cat("Nombre de lignes lues :", length(anohosp1), "\n")

if (length(anohosp1) > 0) {
  cat("\nPremi√®res lignes :\n")
  print(head(anohosp1, 3))
}

# --- TEST 3 : Lecture avec encodage latin1 --------------------------------
cat("\n--- Lecture avec locale(encoding='latin1') ---\n")
anohosp2 <- read_lines(fichier, locale = locale(encoding = "latin1"))
cat("Nombre de lignes lues :", length(anohosp2), "\n")

if (length(anohosp2) > 0) {
  print(head(anohosp2, 3))
}

# --- TEST 4 : V√©rifier le premier caract√®re de chaque ligne ---------------
if (length(anohosp2) > 0) {
  cat("\n--- Comptage du premier caract√®re par ligne ---\n")
  print(table(substr(anohosp2, 1, 1)))
}

# --- TEST 5 : V√©rifier si BOM UTF-8 pr√©sent -------------------------------
if (length(anohosp2) > 0) {
  cat("\n--- Octets du d√©but de la premi√®re ligne ---\n")
  print(charToRaw(substr(anohosp2[1], 1, 5)))
}

# --- TEST 6 : V√©rifier les lignes commen√ßant par '8' ----------------------
if (length(anohosp2) > 0) {
  lignes_8 <- anohosp2[str_detect(anohosp2, "^8")]
  cat("\nNombre de lignes commen√ßant exactement par '8' :", length(lignes_8), "\n")
  
  lignes_8_trim <- anohosp2[str_detect(str_trim(anohosp2), "^8")]
  cat("Nombre de lignes commen√ßant par '8' apr√®s trim :", length(lignes_8_trim), "\n")
}

# --- TEST 7 : Version du package readr ------------------------------------
cat("\n--- Version du package readr ---\n")
print(packageVersion("readr"))

# --- CONCLUSION ------------------------------------------------------------
cat("\n‚úÖ Si un des tests ci-dessus renvoie 0 lignes lues ou 0 lignes commen√ßant par '8',\n")
cat("   cela signifie que le probl√®me vient de l'encodage, d'un BOM ou du chemin r√©seau.\n")
cat("   Le test des octets (TEST 5) te dira si un BOM est pr√©sent : EF BB BF = BOM UTF-8.\n")
