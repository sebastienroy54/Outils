sag_path = os.path.join(BASE_DIR, SAG_NAME)
if not os.path.exists(sag_path):
    raise FileNotFoundError(f"Fichier SAG introuvable: {sag_path}")

sag = read_sag_dmi(sag_path)

abs_action = enrich_absents_with_sag(
    abs_export,
    sag=sag,
    equiv_map=LPP_EQUIV,
    tol_days=2
)

export_excel_with_date_formats(abs_action, os.path.join(BASE_DIR, "pharma_absents_actionnables.xlsx"), sheet_name="absents_actionnables")
print("Absents actionnables:", len(abs_action))
print(abs_action["Statut final"].value_counts().to_string())
